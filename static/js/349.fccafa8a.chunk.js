(self.webpackChunkfree_reporting=self.webpackChunkfree_reporting||[]).push([[349],{2349:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return D}});var r=n(4165),i=n(1413),a=n(5861),o=n(2791),s=(n(9836),n(5671)),u=n(3144),c=n(136),p=n(9388),d=n(8721),l=function(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(t){a(t)}}function s(e){try{u(r.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},f=function(e){(0,c.Z)(n,e);var t=(0,p.Z)(n);function n(){var e;return(0,s.Z)(this,n),(e=t.apply(this,arguments))._host=o.createRef(),e}return(0,u.Z)(n,[{key:"componentDidMount",value:function(){return l(this,void 0,void 0,(0,r.Z)().mark((function e(){var t=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this._designer||(this._designer=new d.l(this._host.current,{language:this.props.language,disableOpenSaveHotkeys:!1===this.props.hotkeysEnabled,customInitTemplates:this.props.customInitTemplates})),e.next=3,this._designer.setResourceProvider({getImagesList:function(){return l(t,void 0,void 0,(0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null!==(t=this.props.imageList)&&void 0!==t?t:[]);case 1:case"end":return e.stop()}}),e,this)})))},getReportsList:function(){return l(t,void 0,void 0,(0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null!==(t=this.props.reportList)&&void 0!==t?t:[]);case 1:case"end":return e.stop()}}),e,this)})))},getThemesList:function(){return l(t,void 0,void 0,(0,r.Z)().mark((function e(){var t;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null!==(t=this.props.themeList)&&void 0!==t?t:[]);case 1:case"end":return e.stop()}}),e,this)})))}});case 3:return e.next=5,this.applyProps({},this.props);case 5:case"end":return e.stop()}}),e,this)})))}},{key:"componentDidUpdate",value:function(e){return l(this,void 0,void 0,(0,r.Z)().mark((function t(){return(0,r.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this._designer){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.applyProps(e,this.props);case 4:e.language!==this.props.language&&console.warn("Changing 'language' is not supported."),e.hotkeysEnabled!==this.props.hotkeysEnabled&&console.warn("Changing 'hotkeysEnabled' is not supported."),this.areDeepEqual(e.customInitTemplates,this.props.customInitTemplates)||console.warn("Changing 'customInitTemplates' is not supported.");case 7:case"end":return t.stop()}}),t,this)})))}},{key:"areDeepEqual",value:function(e,t){return JSON.stringify(e)===JSON.stringify(t)}},{key:"isReportDef",value:function(e){var t;return!!(null===(t=e)||void 0===t?void 0:t.definition)}},{key:"shouldReportUpdate",value:function(e,t){return(null===e||void 0===e?void 0:e.id)!==(null===t||void 0===t?void 0:t.id)||(null===e||void 0===e?void 0:e.displayName)!==(null===t||void 0===t?void 0:t.displayName)||(this.isReportDef(e)&&e.definition)!==(this.isReportDef(t)&&t.definition)}},{key:"applyProps",value:function(e,t){var n,i;return l(this,void 0,void 0,(0,r.Z)().mark((function a(){var o;return(0,r.Z)().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(o=this._designer){r.next=4;break}return console.warn("Designer is not initialized yet."),r.abrupt("return");case 4:if(!this.shouldReportUpdate(t.report,e.report)){r.next=12;break}if(!t.report){r.next=10;break}return r.next=8,o.setReport(t.report,"override");case 8:r.next=12;break;case 10:return r.next=12,o.createReport({reportType:"CPL"},"override");case 12:if(t.dataSources===e.dataSources){r.next=16;break}return r.next=16,o.setDataSourceTemplates(null!==(n=t.dataSources)&&void 0!==n?n:[]);case 16:if(t.fontSet!==e.fontSet&&(o.fontSet=null!==(i=t.fontSet)&&void 0!==i?i:"all"),t.onCreate===e.onCreate&&t.onOpen===e.onOpen&&t.onOpenFileMenu===e.onOpenFileMenu&&t.onRender===e.onRender&&t.onSave===e.onSave&&t.onSaveAs===e.onSaveAs){r.next=20;break}return r.next=20,o.setActionHandlers({onCreate:t.onCreate,onOpen:t.onOpen,onOpenFileMenu:t.onOpenFileMenu,onRender:t.onRender,onSave:t.onSave,onSaveAs:t.onSaveAs});case 20:case"end":return r.stop()}}),a,this)})))}},{key:"setReport",value:function(e,t){if(null==this._designer)throw new Error("Designer is not initialized yet");return this._designer.setReport(e,t)}},{key:"getReport",value:function(){if(!this._designer)throw new Error("Designer is not initialized yet");return this._designer.getReport()}},{key:"createReport",value:function(e,t){if(null==this._designer)throw new Error("Designer is not initialized yet");return this._designer.createReport(e,t)}},{key:"processCommand",value:function(e){if(!this._designer)throw new Error("Designer is not initialized yet");return this._designer.processCommand(e)}},{key:"render",value:function(){return o.createElement("div",{ref:this._host,style:{height:"100%"}})}}]),n}(o.Component),h=n(4577),v=n(8493),g=n(2517),m=n(1562),y=n(7321),S=n(7689),w=JSON.parse('{"id":"NewFile","displayName":"NewFile","definition":{"Name":"Report","Width":"8.2604in","Layers":[{"Name":"default"}],"CustomProperties":[{"Name":"DisplayType","Value":"Page"},{"Name":"SizeType","Value":"Default"},{"Name":"PaperOrientation","Value":"Portrait"}],"Page":{"PageWidth":"8.27in","PageHeight":"11.69in","RightMargin":"0in","LeftMargin":"0in","TopMargin":"0in","BottomMargin":"0in","Columns":1,"ColumnSpacing":"0in"},"DataSources":[{"Name":"DataSource","ConnectionProperties":{"DataProvider":"JSONEMBED","ConnectString":"jsondata=[{\\"data\\":\\"xyz\\"}]"}}],"Body":{"Height":"11.6667in","ReportItems":[{"Type":"table","Name":"Table1","ZIndex":1,"DataSetName":"DataSet","TableColumns":[{"Width":"8.25in"}],"Details":{"TableRows":[{"Height":"11.6667in","TableCells":[{"Item":{"Type":"rectangle","Name":"Container1","ZIndex":2,"Width":"8.25in","Height":"11.6667in"}}]}]},"Left":"0.0104in","Width":"8.25in","Height":"11.6667in"}],"Style":{"Border":{"Width":"0pt"}}},"DataSets":[{"Name":"DataSet","Fields":[{"Name":"data","DataField":"data"}],"Query":{"DataSourceName":"DataSource","CommandText":"jpath=$.*"},"CaseSensitivity":"Auto","KanatypeSensitivity":"Auto","AccentSensitivity":"Auto","WidthSensitivity":"Auto"}]}}'),k=n(7676),x=n(5367),b=n(184);var D=function(){var e=(0,o.useRef)(),t=(0,k.il)(),n=(0,v.dd)(),s=n.asyncDispatchModal,u=n.dispatchModal,c=(0,S.s0)(),p=(0,x.a)().user;(0,o.useEffect)((function(){var t=new URLSearchParams(window.location.search).get("id");if(null!==t&&void 0!==t)try{var n=sessionStorage.getItem(t);e.current.setReport(JSON.parse(n))}catch(r){}else e.current.setReport(w)}),[]);var d=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(n=sessionStorage.getItem("fileName"))){e.next=6;break}return sessionStorage.removeItem("fileName"),e.abrupt("return",Promise.resolve((0,i.Z)({displayName:n},t)));case 6:return e.abrupt("return",new Promise((function(e){setTimeout((0,a.Z)((0,r.Z)().mark((function n(){var i;return(0,r.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,d(t);case 2:i=n.sent,e(i);case 4:case"end":return n.stop()}}),n)}))),1e3)})));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=(0,a.Z)((0,r.Z)().mark((function e(n){var i,a;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("NewFile"!==n.displayName){e.next=11;break}return i=0,p.files.forEach((function(e){return i+=parseInt(e.id)})),n.id=i,e.next=6,s({type:g.o.SAVE_NEW_FILE,payload:n});case 6:return e.next=8,d(n);case 8:return e.abrupt("return",e.sent);case 11:(a=(0,h.wG)(h.Tr.PUT,h.xd.SAVE_FILE,n)).status===m.Y.FILE_SAVED_SUCCESSFUL&&t.dispatch(y.o.FILE_SAVED),n=a.data.files.find((function(e){return e.id===n.id}));case 14:return e.abrupt("return",Promise.resolve(n));case 15:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,b.jsx)("div",{id:"designer-host",children:(0,b.jsx)(f,{onSave:l,ref:e,onRender:function(e){var t=JSON.stringify(e);try{sessionStorage.setItem(e.id,t),c("/Viewer?id=".concat(e.id))}catch(n){console.log(n)}},onOpen:function(){u({type:g.o.OPEN_FILES,payload:e})},onCreate:function(){return Promise.resolve((0,i.Z)({},w))}})})}},9836:function(e,t,n){n(3694)}}]);
//# sourceMappingURL=349.fccafa8a.chunk.js.map